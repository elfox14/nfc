<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>بطاقة عمل <%= cardName %> | <%= cardTagline %></title>
    <meta name="description" content="تواصل مع <%= cardName %>، <%= cardTagline %>. اعرض بيانات الاتصال، واحفظها بضغطة زر عبر بطاقة العمل الرقمية.">
    <meta name="keywords" content="بطاقة عمل رقمية, vCard, <%= cardName %>, <%= cardTagline %>, بيانات اتصال">
    
    <link rel="canonical" href="<%= pageUrl %>" />
    <meta property="og:title" content="بطاقة عمل <%= cardName %>" />
    <meta property="og:description" content="اعرض واحفظ بيانات الاتصال الخاصة بـ <%= cardName %> بسهولة." />
    <meta property="og:image" content="<%= cardImage %>" />
    <meta property="og:url" content="<%= pageUrl %>" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image">
    <link rel="icon" id="favicon" href="<%= cardImage %>" type="image/png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Aref+Ruqaa:wght@400;700&family=Cairo:wght@400;700&family=El+Messiri:wght@400;700&family=Lalezar&family=Lemonada:wght@400;700&family=Markazi+Text:wght@400;700&family=Noto+Sans+Arabic:wght@400;700&family=Poppins:wght@400;700&family=Reem+Kufi:wght@400;700&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <link rel="stylesheet" href="/style.css"> 
    <link rel="stylesheet" href="/viewer.css">

    <script>
      window.cardData = <%- JSON.stringify(cardData) %>;
    </script>
    
    <script type="application/ld+json">
    <%
      const personSchema = {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": cardName,
        "jobTitle": cardTagline,
        "url": pageUrl,
        "image": cardImage
      };

      if (cardData.inputs && cardData.inputs['input-email']) {
        personSchema.email = `mailto:${cardData.inputs['input-email']}`;
      }
      if (cardData.dynamic && cardData.dynamic.phones && cardData.dynamic.phones.length > 0) {
        personSchema.telephone = cardData.dynamic.phones[0];
      }

      const sameAsUrls = [];
      const staticSocials = ['input-website', 'input-facebook', 'input-linkedin'];
      staticSocials.forEach(key => {
        if (cardData.inputs && cardData.inputs[key]) {
          sameAsUrls.push(cardData.inputs[key]);
        }
      });

      if (cardData.dynamic && cardData.dynamic.social) {
          const prefixes = {
              instagram: 'https://instagram.com/', x: 'https://x.com/',
              telegram: 'https://t.me/', tiktok: 'https://tiktok.com/@',
              snapchat: 'https://snapchat.com/add/', youtube: 'https://youtube.com/',
              pinterest: 'https://pinterest.com/'
          };
          cardData.dynamic.social.forEach(link => {
            if (link.value) {
              let fullUrl = link.value;
              if (!/^(https?:\/\/)/i.test(fullUrl) && prefixes[link.platform]) {
                  fullUrl = prefixes[link.platform] + fullUrl;
              }
              sameAsUrls.push(fullUrl);
            }
          });
      }

      if (sameAsUrls.length > 0) {
        personSchema.sameAs = sameAsUrls;
      }
    %>
    <%- JSON.stringify(personSchema, null, 2) %>
    </script>
    </head>
<body>

    <div id="loader" class="viewer-loader">
        <div class="spinner"></div>
        <p>جاري تجهيز البطاقة...</p>
    </div>

    <div class="viewer-container" style="display: none;">
        
        <div class="cta-section">
            <h3>هل تريد بطاقة مثل هذه؟</h3>
            <a href="/" target="_blank" rel="noopener noreferrer" class="btn btn-secondary">اصنع بطاقتك الخاصة الآن</a>
        </div>

        <main class="cards-wrapper" id="cards-wrapper" tabindex="0">
            </main>
        
        <button id="mobile-flip-btn" class="mobile-flip-btn" aria-label="تقليب البطاقة" style="display: none;">
            <i class="fas fa-sync-alt"></i>
        </button>

        <div class="save-options">
            <h2>خيارات الحفظ والمشاركة</h2>
            
            <button id="save-front-png-btn" class="btn btn-primary"><i class="fas fa-image"></i> حفظ الواجهة (PNG)</button>
            <button id="save-back-png-btn" class="btn btn-primary"><i class="fas fa-image"></i> حفظ الخلفية (PNG)</button>
            <button id="save-pdf-btn" class="btn btn-primary"><i class="fas fa-file-pdf"></i> حفظ كملف PDF</button>
            <button id="save-vcf-btn" class="btn btn-primary"><i class="fas fa-address-card"></i> حفظ جهة الاتصال</button>
        </div>

    </div>
    
    <div id="qrcode-container-temp" class="visually-hidden"></div>
    
    <script src="/viewer.js"></script>

    <footer>
      &copy; 2025 جميع الحقوق محفوظة. | 
      <a href="/index.html">الرئيسية</a> | 
      <a href="/blog.html">المدونة</a> |
      <a href="/about.html">من نحن</a> |
      <a href="/contact.html">اتصل بنا</a> | 
      <a href="/privacy.html">سياسة الخصوصية</a>
    </footer>

</body>
</html>