/**\n * Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ø§ÙˆÙ† Ø§Ù„Ù…ØªØ²Ø§Ù…Ù† (Real-time Collaboration System)\n * \n * ÙŠÙˆÙØ± Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¥Ù…ÙƒØ§Ù†ÙŠØ§Øª Ø§Ù„ØªØ¹Ø§ÙˆÙ† Ø§Ù„Ù…ØªØ²Ø§Ù…Ù† Ø¨ÙŠÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†\n */\n\n/**\n * ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…ØªØµÙ„ (Connected User)\n */\nclass ConnectedUser {\n  constructor(userId, userName, color) {\n    this.userId = userId;\n    this.userName = userName;\n    this.color = color;\n    this.lastActivity = new Date();\n    this.cursorPosition = { x: 0, y: 0 };\n    this.isEditing = false;\n  }\n\n  /**\n   * ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± Ù†Ø´Ø§Ø·\n   */\n  updateActivity() {\n    this.lastActivity = new Date();\n  }\n\n  /**\n   * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…\n   */\n  getInfo() {\n    return {\n      userId: this.userId,\n      userName: this.userName,\n      color: this.color,\n      lastActivity: this.lastActivity.toISOString(),\n      isEditing: this.isEditing\n    };\n  }\n}\n\n/**\n * ÙØ¦Ø© Ø§Ù„Ø­Ø¯Ø« (Event)\n */\nclass CollaborationEvent {\n  constructor(type, userId, data = {}) {\n    this.id = 'evt_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\n    this.type = type; // edit, delete, add, comment, etc.\n    this.userId = userId;\n    this.timestamp = new Date();\n    this.data = data;\n  }\n\n  /**\n   * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø¯Ø«\n   */\n  getInfo() {\n    return {\n      id: this.id,\n      type: this.type,\n      userId: this.userId,\n      timestamp: this.timestamp.toISOString(),\n      data: this.data\n    };\n  }\n}\n\n/**\n * ÙØ¦Ø© Ù…Ø¯ÙŠØ± Ø§Ù„ØªØ¹Ø§ÙˆÙ† (Collaboration Manager)\n */\nclass CollaborationManager {\n  constructor(options = {}) {\n    this.connectedUsers = new Map();\n    this.events = [];\n    this.maxEvents = options.maxEvents || 1000;\n    this.eventListeners = [];\n    this.sessionId = options.sessionId || 'session_' + Date.now();\n  }\n\n  /**\n   * Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ù…ØªØµÙ„\n   */\n  addUser(userId, userName, color) {\n    const user = new ConnectedUser(userId, userName, color);\n    this.connectedUsers.set(userId, user);\n    \n    this.broadcastEvent(new CollaborationEvent('user_joined', userId, {\n      userName: userName,\n      color: color\n    }));\n\n    console.log('âœ… Ø§Ù†Ø¶Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', userName);\n    return user;\n  }\n\n  /**\n   * Ø¥Ø²Ø§Ù„Ø© Ù…Ø³ØªØ®Ø¯Ù…\n   */\n  removeUser(userId) {\n    const user = this.connectedUsers.get(userId);\n    if (!user) return false;\n\n    this.connectedUsers.delete(userId);\n    \n    this.broadcastEvent(new CollaborationEvent('user_left', userId, {\n      userName: user.userName\n    }));\n\n    console.log('âœ… ØºØ§Ø¯Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', user.userName);\n    return true;\n  }\n\n  /**\n   * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†\n   */\n  getConnectedUsers() {\n    return Array.from(this.connectedUsers.values()).map(u => u.getInfo());\n  }\n\n  /**\n   * ØªØ³Ø¬ÙŠÙ„ Ø­Ø¯Ø« ØªØ­Ø±ÙŠØ±\n   */\n  recordEdit(userId, field, oldValue, newValue) {\n    const event = new CollaborationEvent('edit', userId, {\n      field: field,\n      oldValue: oldValue,\n      newValue: newValue\n    });\n\n    this.broadcastEvent(event);\n    return event;\n  }\n\n  /**\n   * ØªØ³Ø¬ÙŠÙ„ Ø­Ø¯Ø« Ø­Ø°Ù\n   */\n  recordDelete(userId, itemId) {\n    const event = new CollaborationEvent('delete', userId, {\n      itemId: itemId\n    });\n\n    this.broadcastEvent(event);\n    return event;\n  }\n\n  /**\n   * ØªØ³Ø¬ÙŠÙ„ Ø­Ø¯Ø« Ø¥Ø¶Ø§ÙØ©\n   */\n  recordAdd(userId, itemType, itemData) {\n    const event = new CollaborationEvent('add', userId, {\n      itemType: itemType,\n      itemData: itemData\n    });\n\n    this.broadcastEvent(event);\n    return event;\n  }\n\n  /**\n   * ØªØ³Ø¬ÙŠÙ„ ØªØ¹Ù„ÙŠÙ‚\n   */\n  recordComment(userId, comment, position = null) {\n    const event = new CollaborationEvent('comment', userId, {\n      comment: comment,\n      position: position\n    });\n\n    this.broadcastEvent(event);\n    return event;\n  }\n\n  /**\n   * ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¤Ø´Ø±\n   */\n  updateCursorPosition(userId, x, y) {\n    const user = this.connectedUsers.get(userId);\n    if (user) {\n      user.cursorPosition = { x, y };\n      user.updateActivity();\n    }\n  }\n\n  /**\n   * ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ø±ÙŠØ±\n   */\n  setEditingState(userId, isEditing) {\n    const user = this.connectedUsers.get(userId);\n    if (user) {\n      user.isEditing = isEditing;\n      user.updateActivity();\n    }\n  }\n\n  /**\n   * Ø¨Ø« Ø§Ù„Ø­Ø¯Ø«\n   */\n  broadcastEvent(event) {\n    this.events.push(event);\n\n    // Ø¥Ø¯Ø§Ø±Ø© Ø­Ø¯ Ø£Ù‚ØµÙ‰ Ù„Ù„Ø£Ø­Ø¯Ø§Ø«\n    if (this.events.length > this.maxEvents) {\n      this.events.shift();\n    }\n\n    // Ø¥Ø®Ø·Ø§Ø± Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†\n    this.eventListeners.forEach(listener => {\n      listener(event);\n    });\n\n    console.log('ğŸ“¢ ØªÙ… Ø¨Ø« Ø§Ù„Ø­Ø¯Ø«:', event.type);\n  }\n\n  /**\n   * Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø£Ø­Ø¯Ø§Ø«\n   */\n  on(callback) {\n    this.eventListeners.push(callback);\n  }\n\n  /**\n   * Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹\n   */\n  off(callback) {\n    const index = this.eventListeners.indexOf(callback);\n    if (index !== -1) {\n      this.eventListeners.splice(index, 1);\n    }\n  }\n\n  /**\n   * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«\n   */\n  getEventHistory(limit = 50) {\n    return this.events.slice(-limit).map(e => e.getInfo());\n  }\n\n  /**\n   * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£Ø­Ø¯Ø§Ø« Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø¯Ø¯\n   */\n  getUserEvents(userId, limit = 20) {\n    return this.events\n      .filter(e => e.userId === userId)\n      .slice(-limit)\n      .map(e => e.getInfo());\n  }\n\n  /**\n   * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¬Ù„Ø³Ø©\n   */\n  getSessionStats() {\n    return {\n      sessionId: this.sessionId,\n      connectedUsers: this.connectedUsers.size,\n      totalEvents: this.events.length,\n      eventsByType: this.getEventTypeStats(),\n      startTime: this.events.length > 0 ? this.events[0].timestamp : null,\n      endTime: this.events.length > 0 ? this.events[this.events.length - 1].timestamp : null\n    };\n  }\n\n  /**\n   * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«\n   */\n  getEventTypeStats() {\n    const stats = {};\n    this.events.forEach(e => {\n      stats[e.type] = (stats[e.type] || 0) + 1;\n    });\n    return stats;\n  }\n\n  /**\n   * ØªØµØ¯ÙŠØ± Ø³Ø¬Ù„ Ø§Ù„Ø¬Ù„Ø³Ø©\n   */\n  exportSession() {\n    return JSON.stringify({\n      sessionId: this.sessionId,\n      users: this.getConnectedUsers(),\n      events: this.events.map(e => e.getInfo()),\n      stats: this.getSessionStats()\n    }, null, 2);\n  }\n\n  /**\n   * Ù…Ø³Ø­ Ø§Ù„Ø¬Ù„Ø³Ø©\n   */\n  clearSession() {\n    this.connectedUsers.clear();\n    this.events = [];\n    this.eventListeners = [];\n    console.log('âœ… ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¬Ù„Ø³Ø©');\n  }\n}\n\n/**\n * ÙØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª (Comments System)\n */\nclass CommentsSystem {\n  constructor() {\n    this.comments = [];\n  }\n\n  /**\n   * Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚\n   */\n  addComment(userId, userName, text, position = null) {\n    const comment = {\n      id: 'comment_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),\n      userId: userId,\n      userName: userName,\n      text: text,\n      position: position,\n      timestamp: new Date().toISOString(),\n      replies: [],\n      resolved: false\n    };\n\n    this.comments.push(comment);\n    console.log('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚');\n    return comment;\n  }\n\n  /**\n   * Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ ØªØ¹Ù„ÙŠÙ‚\n   */\n  replyToComment(commentId, userId, userName, text) {\n    const comment = this.comments.find(c => c.id === commentId);\n    if (!comment) return null;\n\n    const reply = {\n      userId: userId,\n      userName: userName,\n      text: text,\n      timestamp: new Date().toISOString()\n    };\n\n    comment.replies.push(reply);\n    console.log('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø±Ø¯');\n    return reply;\n  }\n\n  /**\n   * Ø­Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚\n   */\n  resolveComment(commentId) {\n    const comment = this.comments.find(c => c.id === commentId);\n    if (comment) {\n      comment.resolved = true;\n      console.log('âœ… ØªÙ… Ø­Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚');\n    }\n    return comment;\n  }\n\n  /**\n   * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª\n   */\n  getAllComments() {\n    return this.comments;\n  }\n\n  /**\n   * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©\n   */\n  getUnresolvedComments() {\n    return this.comments.filter(c => !c.resolved);\n  }\n\n  /**\n   * Ø­Ø°Ù ØªØ¹Ù„ÙŠÙ‚\n   */\n  deleteComment(commentId) {\n    const index = this.comments.findIndex(c => c.id === commentId);\n    if (index === -1) return false;\n\n    this.comments.splice(index, 1);\n    console.log('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚');\n    return true;\n  }\n}\n\n// ØªØµØ¯ÙŠØ± Ø§Ù„ÙØ¦Ø§Øª\nif (typeof module !== 'undefined' && module.exports) {\n  module.exports = {\n    ConnectedUser,\n    CollaborationEvent,\n    CollaborationManager,\n    CommentsSystem\n  };\n}\n
